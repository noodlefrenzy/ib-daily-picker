<!-- Open Trade Form Modal -->
{% macro open_trade_form(symbol=None) %}
<div class="modal-overlay" id="trade-form-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Open Trade</h3>
            <button class="modal-close" onclick="document.getElementById('trade-form-modal').remove()">&times;</button>
        </div>
        <form hx-post="/api/trades"
              hx-target="#modal-container"
              hx-swap="innerHTML"
              hx-trigger="submit">
            <div class="form-group">
                <label for="symbol">Symbol</label>
                <input type="text" id="symbol" name="symbol" value="{{ symbol or '' }}" required
                       pattern="[A-Za-z]+" title="Stock ticker symbol" style="text-transform: uppercase;">
            </div>
            <div class="form-group">
                <label for="direction">Direction</label>
                <select id="direction" name="direction" required>
                    <option value="long">Long</option>
                    <option value="short">Short</option>
                </select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="entry_price">Entry Price</label>
                    <input type="number" id="entry_price" name="entry_price" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="position_size">Position Size</label>
                    <input type="number" id="position_size" name="position_size" step="0.01" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="stop_loss">Stop Loss</label>
                    <input type="number" id="stop_loss" name="stop_loss" step="0.01">
                </div>
                <div class="form-group">
                    <label for="take_profit">Take Profit</label>
                    <input type="number" id="take_profit" name="take_profit" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <label for="notes">Notes</label>
                <textarea id="notes" name="notes" rows="3"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary"
                        onclick="document.getElementById('trade-form-modal').remove()">Cancel</button>
                <button type="submit" class="btn btn-primary">Open Trade</button>
            </div>
        </form>
    </div>
</div>
{% endmacro %}

<!-- Close Trade Form Modal -->
{% macro close_trade_form(trade) %}
<div class="modal-overlay" id="close-form-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Close Trade: {{ trade.symbol }}</h3>
            <button class="modal-close" onclick="document.getElementById('close-form-modal').remove()">&times;</button>
        </div>
        <div class="trade-summary">
            <p><strong>Entry:</strong> ${{ "%.2f"|format(trade.entry_price) }} |
               <strong>Size:</strong> {{ trade.position_size }} |
               <strong>Direction:</strong> {{ trade.direction.value|upper }}</p>
        </div>
        <form hx-post="/api/trades/{{ trade.id }}/close"
              hx-target="body"
              hx-swap="innerHTML">
            <div class="form-group">
                <label for="exit_price">Exit Price</label>
                <input type="number" id="exit_price" name="exit_price" step="0.01" required>
            </div>
            <div class="form-group">
                <label for="notes">Closing Notes</label>
                <textarea id="notes" name="notes" rows="3"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary"
                        onclick="document.getElementById('close-form-modal').remove()">Cancel</button>
                <button type="submit" class="btn btn-primary">Close Trade</button>
            </div>
        </form>
    </div>
</div>
{% endmacro %}

<!-- Execute Recommendation Form Modal -->
{% macro execute_recommendation_form(rec) %}
<div class="modal-overlay" id="execute-form-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Execute: {{ rec.symbol }} {{ rec.signal_type.value|upper }}</h3>
            <button class="modal-close" onclick="document.getElementById('execute-form-modal').remove()">&times;</button>
        </div>
        <div class="recommendation-summary">
            <p><strong>Strategy:</strong> {{ rec.strategy_name }}</p>
            <p><strong>Suggested Entry:</strong> ${{ "%.2f"|format(rec.entry_price) if rec.entry_price else 'N/A' }}</p>
            <p><strong>Stop Loss:</strong> ${{ "%.2f"|format(rec.stop_loss) if rec.stop_loss else 'N/A' }}</p>
            <p><strong>Take Profit:</strong> ${{ "%.2f"|format(rec.take_profit) if rec.take_profit else 'N/A' }}</p>
            {% if rec.reasoning %}
            <p class="reasoning"><em>{{ rec.reasoning }}</em></p>
            {% endif %}
        </div>
        <form hx-post="/api/recommendations/{{ rec.id }}/execute"
              hx-target="body"
              hx-swap="innerHTML">
            <div class="form-row">
                <div class="form-group">
                    <label for="entry_price">Entry Price</label>
                    <input type="number" id="entry_price" name="entry_price" step="0.01" required
                           value="{{ "%.2f"|format(rec.entry_price) if rec.entry_price else '' }}">
                </div>
                <div class="form-group">
                    <label for="position_size">Position Size</label>
                    <input type="number" id="position_size" name="position_size" step="0.01" required
                           value="{{ rec.position_size if rec.position_size else '' }}">
                </div>
            </div>
            <div class="form-group">
                <label for="notes">Notes</label>
                <textarea id="notes" name="notes" rows="3"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary"
                        onclick="document.getElementById('execute-form-modal').remove()">Cancel</button>
                <button type="submit" class="btn btn-primary">Execute Trade</button>
            </div>
        </form>
    </div>
</div>
{% endmacro %}

<!-- Add Note Form Modal -->
{% macro add_note_form(trade) %}
<div class="modal-overlay" id="note-form-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Note: {{ trade.symbol }}</h3>
            <button class="modal-close" onclick="document.getElementById('note-form-modal').remove()">&times;</button>
        </div>
        <form hx-post="/api/trades/{{ trade.id }}/note"
              hx-target="#modal-container"
              hx-swap="innerHTML">
            <div class="form-group">
                <label for="note">Note</label>
                <textarea id="note" name="note" rows="4" required></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary"
                        onclick="document.getElementById('note-form-modal').remove()">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Note</button>
            </div>
        </form>
    </div>
</div>
{% endmacro %}
